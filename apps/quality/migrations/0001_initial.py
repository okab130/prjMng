# Generated by Django 4.2.7 on 2025-12-22 16:15

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import simple_history.models
import uuid


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('projects', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('tasks', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='Bug',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='作成日時')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新日時')),
                ('is_deleted', models.BooleanField(default=False, verbose_name='削除フラグ')),
                ('bug_number', models.CharField(max_length=20, verbose_name='バグ番号')),
                ('title', models.CharField(max_length=200, verbose_name='タイトル')),
                ('description', models.TextField(verbose_name='詳細説明')),
                ('status', models.CharField(choices=[('NEW', '新規'), ('IN_PROGRESS', '対応中'), ('FIXED', '修正済'), ('VERIFIED', '確認済'), ('REJECTED', '却下'), ('ON_HOLD', '保留'), ('REOPENED', '再オープン')], default='NEW', max_length=20, verbose_name='ステータス')),
                ('priority', models.CharField(choices=[('CRITICAL', '致命的'), ('HIGH', '重大'), ('MEDIUM', '中'), ('LOW', '軽微')], default='MEDIUM', max_length=10, verbose_name='優先度')),
                ('severity', models.CharField(choices=[('HIGH', '高'), ('MEDIUM', '中'), ('LOW', '低')], default='MEDIUM', max_length=10, verbose_name='重要度')),
                ('category', models.CharField(blank=True, max_length=50, verbose_name='カテゴリ')),
                ('module', models.CharField(blank=True, max_length=100, verbose_name='モジュール')),
                ('found_version', models.CharField(blank=True, max_length=50, verbose_name='発見バージョン')),
                ('fixed_version', models.CharField(blank=True, max_length=50, verbose_name='修正バージョン')),
                ('reproduction_steps', models.TextField(blank=True, verbose_name='再現手順')),
                ('environment', models.TextField(blank=True, verbose_name='環境情報')),
                ('fix_description', models.TextField(blank=True, verbose_name='修正内容')),
                ('test_result', models.TextField(blank=True, verbose_name='テスト結果')),
                ('found_date', models.DateField(auto_now_add=True, verbose_name='発見日')),
                ('fixed_date', models.DateField(blank=True, null=True, verbose_name='修正日')),
                ('verified_date', models.DateField(blank=True, null=True, verbose_name='確認日')),
                ('assignee', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_bugs', to=settings.AUTH_USER_MODEL, verbose_name='担当者')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='作成者')),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='bugs', to='projects.project')),
                ('related_task', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='related_bugs', to='tasks.task', verbose_name='関連タスク')),
                ('reporter', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='reported_bugs', to=settings.AUTH_USER_MODEL, verbose_name='報告者')),
                ('updated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='更新者')),
            ],
            options={
                'verbose_name': 'バグ',
                'verbose_name_plural': 'バグ',
                'db_table': 'bugs',
                'ordering': ['-found_date', '-priority'],
            },
        ),
        migrations.CreateModel(
            name='TestCase',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='作成日時')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新日時')),
                ('is_deleted', models.BooleanField(default=False, verbose_name='削除フラグ')),
                ('test_case_number', models.CharField(max_length=20, verbose_name='テストケース番号')),
                ('title', models.CharField(max_length=200, verbose_name='タイトル')),
                ('category', models.CharField(choices=[('UNIT', '単体テスト'), ('INTEGRATION', '結合テスト'), ('SYSTEM', 'システムテスト'), ('ACCEPTANCE', '受入テスト')], default='UNIT', max_length=20, verbose_name='カテゴリ')),
                ('priority', models.CharField(choices=[('HIGH', '高'), ('MEDIUM', '中'), ('LOW', '低')], default='MEDIUM', max_length=10, verbose_name='優先度')),
                ('precondition', models.TextField(blank=True, verbose_name='前提条件')),
                ('test_steps', models.TextField(verbose_name='テスト手順')),
                ('expected_result', models.TextField(verbose_name='期待結果')),
                ('target_function', models.CharField(blank=True, max_length=100, verbose_name='対象機能')),
                ('module', models.CharField(blank=True, max_length=100, verbose_name='モジュール')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='作成者')),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='test_cases', to='projects.project')),
                ('related_task', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='test_cases', to='tasks.task', verbose_name='関連タスク')),
                ('updated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='更新者')),
            ],
            options={
                'verbose_name': 'テストケース',
                'verbose_name_plural': 'テストケース',
                'db_table': 'test_cases',
                'ordering': ['test_case_number'],
            },
        ),
        migrations.CreateModel(
            name='QualityMetric',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='作成日時')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新日時')),
                ('is_deleted', models.BooleanField(default=False, verbose_name='削除フラグ')),
                ('metric_name', models.CharField(max_length=100, verbose_name='指標名')),
                ('metric_type', models.CharField(max_length=50, verbose_name='指標タイプ')),
                ('target_value', models.DecimalField(decimal_places=2, max_digits=10, verbose_name='目標値')),
                ('actual_value', models.DecimalField(decimal_places=2, max_digits=10, verbose_name='実績値')),
                ('unit', models.CharField(blank=True, max_length=20, verbose_name='単位')),
                ('measured_at', models.DateField(verbose_name='測定日')),
                ('notes', models.TextField(blank=True, verbose_name='備考')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='作成者')),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='quality_metrics', to='projects.project')),
                ('updated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='更新者')),
            ],
            options={
                'verbose_name': '品質メトリクス',
                'verbose_name_plural': '品質メトリクス',
                'db_table': 'quality_metrics',
                'ordering': ['-measured_at'],
            },
        ),
        migrations.CreateModel(
            name='HistoricalTestCase',
            fields=[
                ('id', models.BigIntegerField(auto_created=True, blank=True, db_index=True, verbose_name='ID')),
                ('created_at', models.DateTimeField(blank=True, editable=False, verbose_name='作成日時')),
                ('updated_at', models.DateTimeField(blank=True, editable=False, verbose_name='更新日時')),
                ('is_deleted', models.BooleanField(default=False, verbose_name='削除フラグ')),
                ('test_case_number', models.CharField(max_length=20, verbose_name='テストケース番号')),
                ('title', models.CharField(max_length=200, verbose_name='タイトル')),
                ('category', models.CharField(choices=[('UNIT', '単体テスト'), ('INTEGRATION', '結合テスト'), ('SYSTEM', 'システムテスト'), ('ACCEPTANCE', '受入テスト')], default='UNIT', max_length=20, verbose_name='カテゴリ')),
                ('priority', models.CharField(choices=[('HIGH', '高'), ('MEDIUM', '中'), ('LOW', '低')], default='MEDIUM', max_length=10, verbose_name='優先度')),
                ('precondition', models.TextField(blank=True, verbose_name='前提条件')),
                ('test_steps', models.TextField(verbose_name='テスト手順')),
                ('expected_result', models.TextField(verbose_name='期待結果')),
                ('target_function', models.CharField(blank=True, max_length=100, verbose_name='対象機能')),
                ('module', models.CharField(blank=True, max_length=100, verbose_name='モジュール')),
                ('history_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('history_date', models.DateTimeField(db_index=True)),
                ('history_change_reason', models.CharField(max_length=100, null=True)),
                ('history_type', models.CharField(choices=[('+', 'Created'), ('~', 'Changed'), ('-', 'Deleted')], max_length=1)),
                ('created_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='作成者')),
                ('history_user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('project', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='projects.project')),
                ('related_task', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='tasks.task', verbose_name='関連タスク')),
                ('updated_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='更新者')),
            ],
            options={
                'verbose_name': 'historical テストケース',
                'verbose_name_plural': 'historical テストケース',
                'ordering': ('-history_date', '-history_id'),
                'get_latest_by': ('history_date', 'history_id'),
            },
            bases=(simple_history.models.HistoricalChanges, models.Model),
        ),
        migrations.CreateModel(
            name='HistoricalBug',
            fields=[
                ('id', models.BigIntegerField(auto_created=True, blank=True, db_index=True, verbose_name='ID')),
                ('created_at', models.DateTimeField(blank=True, editable=False, verbose_name='作成日時')),
                ('updated_at', models.DateTimeField(blank=True, editable=False, verbose_name='更新日時')),
                ('is_deleted', models.BooleanField(default=False, verbose_name='削除フラグ')),
                ('bug_number', models.CharField(max_length=20, verbose_name='バグ番号')),
                ('title', models.CharField(max_length=200, verbose_name='タイトル')),
                ('description', models.TextField(verbose_name='詳細説明')),
                ('status', models.CharField(choices=[('NEW', '新規'), ('IN_PROGRESS', '対応中'), ('FIXED', '修正済'), ('VERIFIED', '確認済'), ('REJECTED', '却下'), ('ON_HOLD', '保留'), ('REOPENED', '再オープン')], default='NEW', max_length=20, verbose_name='ステータス')),
                ('priority', models.CharField(choices=[('CRITICAL', '致命的'), ('HIGH', '重大'), ('MEDIUM', '中'), ('LOW', '軽微')], default='MEDIUM', max_length=10, verbose_name='優先度')),
                ('severity', models.CharField(choices=[('HIGH', '高'), ('MEDIUM', '中'), ('LOW', '低')], default='MEDIUM', max_length=10, verbose_name='重要度')),
                ('category', models.CharField(blank=True, max_length=50, verbose_name='カテゴリ')),
                ('module', models.CharField(blank=True, max_length=100, verbose_name='モジュール')),
                ('found_version', models.CharField(blank=True, max_length=50, verbose_name='発見バージョン')),
                ('fixed_version', models.CharField(blank=True, max_length=50, verbose_name='修正バージョン')),
                ('reproduction_steps', models.TextField(blank=True, verbose_name='再現手順')),
                ('environment', models.TextField(blank=True, verbose_name='環境情報')),
                ('fix_description', models.TextField(blank=True, verbose_name='修正内容')),
                ('test_result', models.TextField(blank=True, verbose_name='テスト結果')),
                ('found_date', models.DateField(blank=True, editable=False, verbose_name='発見日')),
                ('fixed_date', models.DateField(blank=True, null=True, verbose_name='修正日')),
                ('verified_date', models.DateField(blank=True, null=True, verbose_name='確認日')),
                ('history_id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('history_date', models.DateTimeField(db_index=True)),
                ('history_change_reason', models.CharField(max_length=100, null=True)),
                ('history_type', models.CharField(choices=[('+', 'Created'), ('~', 'Changed'), ('-', 'Deleted')], max_length=1)),
                ('assignee', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='担当者')),
                ('created_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='作成者')),
                ('history_user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL)),
                ('project', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='projects.project')),
                ('related_task', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='tasks.task', verbose_name='関連タスク')),
                ('reporter', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='報告者')),
                ('updated_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='更新者')),
            ],
            options={
                'verbose_name': 'historical バグ',
                'verbose_name_plural': 'historical バグ',
                'ordering': ('-history_date', '-history_id'),
                'get_latest_by': ('history_date', 'history_id'),
            },
            bases=(simple_history.models.HistoricalChanges, models.Model),
        ),
        migrations.CreateModel(
            name='BugComment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='作成日時')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新日時')),
                ('is_deleted', models.BooleanField(default=False, verbose_name='削除フラグ')),
                ('comment', models.TextField(verbose_name='コメント')),
                ('bug', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='comments', to='quality.bug')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='作成者')),
                ('updated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='更新者')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'バグコメント',
                'verbose_name_plural': 'バグコメント',
                'db_table': 'bug_comments',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='TestExecution',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='作成日時')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新日時')),
                ('is_deleted', models.BooleanField(default=False, verbose_name='削除フラグ')),
                ('executed_at', models.DateTimeField(auto_now_add=True, verbose_name='実行日時')),
                ('result', models.CharField(choices=[('PASSED', '成功'), ('FAILED', '失敗'), ('NOT_EXECUTED', '未実施'), ('NOT_APPLICABLE', 'N/A')], default='NOT_EXECUTED', max_length=20, verbose_name='結果')),
                ('actual_result', models.TextField(blank=True, verbose_name='実績結果')),
                ('execution_time', models.DecimalField(blank=True, decimal_places=2, max_digits=6, null=True, verbose_name='実行時間(分)')),
                ('notes', models.TextField(blank=True, verbose_name='備考')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='作成者')),
                ('executor', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL, verbose_name='実行者')),
                ('related_bug', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='test_executions', to='quality.bug', verbose_name='関連バグ')),
                ('test_case', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='executions', to='quality.testcase')),
                ('updated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='+', to=settings.AUTH_USER_MODEL, verbose_name='更新者')),
            ],
            options={
                'verbose_name': 'テスト実行',
                'verbose_name_plural': 'テスト実行',
                'db_table': 'test_executions',
                'ordering': ['-executed_at'],
                'indexes': [models.Index(fields=['test_case', 'executed_at'], name='test_execut_test_ca_40e7bd_idx'), models.Index(fields=['executor', 'result'], name='test_execut_executo_c29d12_idx')],
            },
        ),
        migrations.AddIndex(
            model_name='testcase',
            index=models.Index(fields=['project', 'category'], name='test_cases_project_f7ec18_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='testcase',
            unique_together={('project', 'test_case_number')},
        ),
        migrations.AddIndex(
            model_name='qualitymetric',
            index=models.Index(fields=['project', 'measured_at'], name='quality_met_project_700a60_idx'),
        ),
        migrations.AddIndex(
            model_name='qualitymetric',
            index=models.Index(fields=['metric_type', 'measured_at'], name='quality_met_metric__a97fe0_idx'),
        ),
        migrations.AddIndex(
            model_name='bug',
            index=models.Index(fields=['project', 'status'], name='bugs_project_c94c41_idx'),
        ),
        migrations.AddIndex(
            model_name='bug',
            index=models.Index(fields=['assignee', 'status'], name='bugs_assigne_204f42_idx'),
        ),
        migrations.AddIndex(
            model_name='bug',
            index=models.Index(fields=['priority', 'status'], name='bugs_priorit_a6d780_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='bug',
            unique_together={('project', 'bug_number')},
        ),
    ]
